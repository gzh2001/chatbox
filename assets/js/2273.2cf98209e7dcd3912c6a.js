"use strict";(self.webpackChunkxyz_chatboxapp_ce=self.webpackChunkxyz_chatboxapp_ce||[]).push([[2273],{42273:(e,s,t)=>{t.r(s),t.d(s,{component:()=>ve});var r=t(74848),n=t(99460),l=t(28597),i=t(55072),o=t(44675),a=t(4241),c=t(82022),d=t(14992),h=t(11641),x=t(14073),m=t(34843),p=t(49921),u=t(56195),g=t(96540),f=t(34195),j=t(63635),C=t(24597),b=t(24648),A=t(8097),v=t(80316),w=t(9470),k=t(60506),y=t(34748),N=t(61224),S=t(64745),T=t(30337),I=t(98984),z=t(55044),B=t(12489),M=t(73896),E=t(3718),R=t(75722),H=t(90286),L=t(26307),D=t(65958),F=t(36920),P=t(11848);const W=()=>(0,r.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.95006 0.823566C4.10229 0.157908 5.44143 -0.110445 6.76118 0.0598457C8.08093 0.230136 9.30808 0.829623 10.2536 1.76596C11.1991 2.7023 11.8106 3.92354 11.9937 5.24156C12.0444 5.60625 11.7899 5.94297 11.4252 5.99365C11.0605 6.04433 10.7238 5.78978 10.6731 5.42509C10.5302 4.39674 10.0531 3.44391 9.31541 2.71336C8.57769 1.98281 7.62024 1.51508 6.59055 1.38222C5.56085 1.24935 4.51603 1.45873 3.61704 1.97809C3.02552 2.31981 2.51873 2.78327 2.12752 3.33333H3.33342C3.7016 3.33333 4.00008 3.63181 4.00008 4C4.00008 4.36819 3.7016 4.66666 3.33342 4.66666H1.01499C1.00489 4.66689 0.994771 4.66689 0.984631 4.66666H0.666748C0.298559 4.66666 8.17196e-05 4.36819 8.17196e-05 4V1.33333C8.17196e-05 0.965139 0.298559 0.666663 0.666748 0.666663C1.03494 0.666663 1.33342 0.965139 1.33342 1.33333V2.1819C1.78579 1.64165 2.33182 1.18073 2.95006 0.823566ZM0.574983 6.00634C0.939668 5.95566 1.27639 6.21021 1.32707 6.5749C1.46998 7.60325 1.94704 8.55609 2.68475 9.28663C3.42247 10.0172 4.37992 10.4849 5.40962 10.6178C6.43931 10.7506 7.48413 10.5413 8.38313 10.0219C8.97464 9.68018 9.48144 9.21672 9.87265 8.66666H8.66675C8.29856 8.66666 8.00008 8.36819 8.00008 8C8.00008 7.63181 8.29856 7.33333 8.66675 7.33333H10.9852C10.9953 7.3331 11.0054 7.3331 11.0155 7.33333H11.3334C11.7016 7.33333 12.0001 7.63181 12.0001 8V10.6667C12.0001 11.0349 11.7016 11.3333 11.3334 11.3333C10.9652 11.3333 10.6667 11.0349 10.6667 10.6667V9.81809C10.2144 10.3583 9.66835 10.8193 9.0501 11.1764C7.89787 11.8421 6.55874 12.1104 5.23899 11.9401C3.91924 11.7699 2.69208 11.1704 1.74656 10.234C0.801035 9.2977 0.189595 8.07646 0.00642763 6.75843C-0.0442532 6.39374 0.210298 6.05702 0.574983 6.00634Z",fill:"#FAB005"})}),X=(0,P.Ay)(N.A)((({theme:e})=>({borderRadius:"9999px",border:"1px solid #FAB005",color:"#FAB005",height:"28px",minHeight:"28px",padding:"0 16px","&:hover":{border:"1px solid #FAB005",backgroundColor:"rgba(250, 176, 5, 0.04)"}}))),O=e=>{const{t:s}=(0,f.Bd)();return(0,r.jsxs)(X,{onClick:()=>{F.A.installUpdate()},type:"button",variant:"outlined",...e,children:[(0,r.jsx)(W,{}),(0,r.jsx)("span",{className:"ml-1 min-w-16 whitespace-nowrap",children:s("Update Available")})]})};function U(){const{t:e}=(0,f.Bd)(),s=(0,A.L0)(),t=(0,A.dZ)(),l=(0,m.md)(v.LM),[i,o]=(0,g.useState)(!1),a=(0,m.Xr)(v.SG),c=(0,m.Xr)(v.Kq),[x,p]=(0,m.fp)(v.Zl),[u,j]=(0,g.useState)(null),C=Boolean(u);(0,g.useEffect)((()=>{const e=F.A.onUpdateDownloaded((()=>{o(!0)}));return()=>{e()}}),[o]);const b=()=>{j(null)};return(0,r.jsxs)(d.A,{className:"controls",children:[i&&(0,r.jsx)(O,{sx:{mr:2}}),s?(0,r.jsx)(h.A,{color:"inherit","aria-label":"menu",onClick:()=>a(!0),sx:{mr:.5},children:(0,r.jsx)(S.A,{})}):(0,r.jsx)(N.A,{component:"label",variant:"outlined",color:"inherit",startIcon:(0,r.jsx)(S.A,{}),sx:{mr:1},onClick:()=>a(!0),size:"small",className:"transform-none opacity-30",children:(0,r.jsx)("span",{className:"justify-between transform-none text-sm",style:{textTransform:"none"},children:(0,r.jsxs)("span",{className:"mr-1",children:[e("Search"),"..."]})})}),t&&(0,r.jsx)(h.A,{color:"inherit","aria-label":"width-full-button",onClick:()=>p(!x),sx:{mr:.5},children:x?(0,r.jsx)(H.A,{}):(0,r.jsx)(R.A,{})}),(0,r.jsx)(h.A,{color:"inherit","aria-label":"thread-history-drawer-button",sx:{mr:.5},onClick:()=>c(!0),children:(0,r.jsx)(T.A,{})}),(0,r.jsx)(h.A,{color:"inherit","aria-label":"more-menu-button",onClick:e=>{e.stopPropagation(),e.preventDefault(),j(e.currentTarget)},children:(0,r.jsx)(z.A,{})}),(0,r.jsxs)(B.A,{anchorEl:u,open:C,onClose:b,children:[(0,r.jsxs)(M.A,{onClick:()=>{n.Ay.show("export-chat"),b()},disableRipple:!0,divider:!0,children:[(0,r.jsx)(I.A,{fontSize:"small"}),e("Export Chat")]}),(0,r.jsx)(L.i,{onDelete:()=>{l&&(w.IU(l.id),b())},label:e("Clear All Messages"),color:"warning",icon:(0,r.jsx)(E.A,{fontSize:"small"})}),(0,r.jsx)(L.i,{onDelete:()=>{l&&((0,D.dF)(l.id),b())},label:e("Delete Current Session")})]})]})}function V(){const{t:e}=(0,f.Bd)(),s=(0,o.A)(),t=(0,m.md)(v.LM),[N,S]=(0,m.fp)(v.f1),T=(0,A.L0)(),{needRoomForMacWindowControls:I,needRoomForWindowsWindowControls:z}=(0,b.A)();(0,g.useEffect)((()=>{if(!t)return;k.tr()&&("Untitled"===t.name&&t.messages.length>=2?w.dk(t.id):!t.threadName&&t.messages.length>=2&&w.hS(t.id))}),[t?.messages.length]);const B=()=>{t&&n.Ay.show("session-settings",{session:t})};let M=null;return M=t&&(0,C.zb)(t)&&t.settings?(0,r.jsx)(a.A,{title:e("Current conversation configured with specific model settings"),className:"cursor-pointer",children:(0,r.jsx)(l.A,{className:"ml-1 cursor-pointer w-4 h-4 opacity-30",fontSize:"small",style:{color:s.palette.warning.main}})}):t&&(0,C.Tw)(t)?(0,r.jsx)(a.A,{title:e("The Image Creator plugin has been activated for the current conversation"),className:"cursor-pointer",children:(0,r.jsx)(c.A,{className:"ml-2 cursor-pointer",variant:"outlined",color:"secondary",size:"small",icon:(0,r.jsx)(i.A,{className:"cursor-pointer"}),label:(0,r.jsx)("span",{className:"cursor-pointer",children:e("Image Creator")})})}):(0,r.jsx)(l.A,{className:"ml-1 cursor-pointer w-4 h-4 opacity-30",fontSize:"small"}),(0,r.jsxs)("div",{className:(0,j.cn)("title-bar flex flex-row h-12 items-center",T?"":N?"sm:pl-3 sm:pr-2":"pr-2",N&&!T||!I?"pl-3":"pl-20"),style:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:s.palette.divider},children:[(!N||T)&&(0,r.jsx)(d.A,{className:(0,j.cn)("controls cursor-pointer"),onClick:()=>S(!N),children:(0,r.jsx)(h.A,{sx:T?{borderColor:s.palette.action.hover,borderStyle:"solid",borderWidth:1}:{},children:(0,r.jsx)(p.A,{size:"20",strokeWidth:1.5})})}),(0,r.jsxs)("div",{className:(0,j.cn)("w-full flex flex-row flex-grow pt-2 pb-2"),children:[(0,r.jsxs)("div",{className:"flex flex-row items-center w-0 flex-1 mr-1",children:[(0,r.jsx)(x.A,{variant:"h6",noWrap:!0,className:(0,j.cn)("flex-shrink flex-grow-0 overflow-hidden text-ellipsis whitespace-nowrap",N?"ml-3":"ml-1"),children:t?.name}),T?(0,r.jsx)(y.A,{className:"ml-1 sm:ml-2 controls cursor-pointer",style:{color:s.palette.text.secondary},onClick:()=>{B()},tooltipTitle:(0,r.jsx)("div",{className:"text-center inline-block",children:(0,r.jsx)("span",{children:e("Customize settings for the current conversation")})}),tooltipPlacement:"top",children:(0,r.jsx)(u.A,{size:"16",strokeWidth:1})}):(0,r.jsx)("a",{onClick:()=>{B()},className:"controls flex mr-8 cursor-pointer",children:M})]}),(0,r.jsx)("div",{className:(0,j.cn)("flex-shrink-0",z?"mr-36":""),children:(0,r.jsx)(U,{})})]})]})}var $=t(66922),_=t(40054),G=t(11507),K=t(5055),Z=t(31330),q=t(8451),Y=t(27562),Q=t(64260),J=t(48517),ee=t(26782),se=t(44992),te=t(71163),re=t(725),ne=t(46013);const le=new Map;function ie(e){const{currentSession:s}=e,{t}=(0,f.Bd)(),n=(0,A.L0)(),l=(0,m.md)(v.im),i=(0,m.md)(v.j6),o=(0,g.useRef)(null),a=(0,g.useRef)(null),c=(0,m.Xr)(v.l2),d=(0,m.Xr)(v.ul),h=(0,m.Xr)(v.wf),x=(0,m.Xr)(v.gx),p=(0,m.Xr)(v.SQ);(0,g.useEffect)((()=>{d(o);const e=o.current;return()=>{e?.getState((e=>{e.ranges.length>0&&le.set(s.id,e)}))}}),[]),(0,g.useEffect)((()=>{c(a)}),[]);const[u,C]=(0,g.useState)(null),[b,k]=(0,g.useState)(null),y=(0,g.useCallback)(((e,s)=>{C(e.currentTarget),k(s)}),[]),N=(0,g.useCallback)((()=>{C(null),k(null)}),[]);return(0,r.jsx)("div",{className:(0,j.cn)("w-full h-full mx-auto",e.className),children:(0,r.jsxs)("div",{className:"overflow-auto h-full pr-0 pl-1 sm:pl-0",ref:a,children:[(0,r.jsx)(te.aY,{data:l,atTopStateChange:h,atBottomStateChange:x,ref:o,followOutput:!0,...le.has(s.id)?{restoreStateFrom:le.get(s.id),initialScrollTop:le.get(s.id)?.scrollTop}:{initialTopMostItemIndex:l.length-1},increaseViewportBy:{top:2e3,bottom:2e3},itemContent:(e,t)=>(0,r.jsxs)(g.Fragment,{children:[i[t.id]&&(0,r.jsx)(ae,{thread:i[t.id],onThreadLabelClick:y}),(0,r.jsx)(ne.A,{id:t.id,msg:t,sessionId:s.id,sessionType:s.type||"chat",className:0===e?"pt-4":"",collapseThreshold:"system"===t.role?150:void 0,preferCollapsedCodeBlock:e<l.length-10}),s.messageForksHash?.[t.id]&&(0,r.jsx)(oe,{msgId:t.id,forks:s.messageForksHash?.[t.id]})]},t.id),components:{Footer:()=>n&&l&&l.filter((e=>"system"!==e.role)).length>0&&(0,r.jsxs)(_.s,{justify:"center",align:"center",gap:"sm",mx:"xs",pt:"xxs",pb:"sm",children:[(0,r.jsx)(G.a,{h:"0.5px",bg:"chatbox-border-primary",flex:1}),i[l[l.length-1].id]?(0,r.jsx)(K.$,{leftSection:(0,r.jsx)(ee.A,{size:16}),classNames:{root:" shadow-sm",section:"!mr-xxs"},size:"xs",c:"chatbox-tertiary",variant:"default",radius:"xl",onClick:()=>w.ix(s.id),children:t("Back to Previous")}):(0,r.jsx)(K.$,{leftSection:(0,r.jsx)(se.A,{size:16}),classNames:{section:"!mr-xxs"},size:"xs",c:"chatbox-tertiary",variant:"default",radius:"xl",onClick:()=>w.L8(),children:t("Start a New Thread")}),(0,r.jsx)(G.a,{h:"0.5px",bg:"chatbox-border-primary",flex:1})]})},onWheel:()=>{re.e0()},onTouchMove:()=>{re.e0()},onScroll:()=>{o.current&&o.current.getState((e=>{a.current&&p(e.scrollTop+a.current.clientHeight)}))},totalListHeightChanged:()=>{o.current&&o.current.getState((e=>{a.current&&p(e.scrollTop+a.current.clientHeight)}))}}),(0,r.jsx)(ce,{threadMenuAnchorEl:u,threadMenuClickedTopicId:b,onThreadMenuClose:N,currentSessionId:s.id})]})})}function oe(e){const{msgId:s,forks:t}=e,n=(0,m.md)(v.Zl),[l,i]=(0,g.useState)(!1),o=(0,g.useRef)(t.lists.length),{t:a}=(0,f.Bd)(),[c,d]=(0,g.useState)(null),[,x]=(0,g.useState)(!1),p=()=>{d(null),x(!1)};return(0,g.useEffect)((()=>{if(t.lists.length>o.current){i(!0);const e=setTimeout((()=>i(!1)),2e3);return()=>clearTimeout(e)}o.current=t.lists.length}),[t.lists.length]),(0,r.jsxs)("div",{className:(0,j.cn)("flex items-center justify-end",n?"w-full":"max-w-4xl mx-auto"),children:[(0,r.jsxs)("div",{className:(0,j.cn)("mt-[-35px] pr-4 inline-flex items-center gap-2","opacity-50 hover:opacity-100",l&&"animate-flash opacity-100 font-bold"),children:[(0,r.jsx)(h.A,{"aria-label":"fork-left",size:"small",className:"hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",onClick:()=>w.v7(s,"prev"),children:(0,r.jsx)(q.A,{className:"w-5 h-5"})}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs cursor-pointer",onClick:e=>{d(e.currentTarget),x(!1)},children:[(0,r.jsx)("span",{children:t.position+1}),(0,r.jsx)("span",{children:"/"}),(0,r.jsx)("span",{children:t.lists.length})]}),(0,r.jsx)(h.A,{"aria-label":"fork-right",size:"small",className:"hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",onClick:()=>w.v7(s,"next"),children:(0,r.jsx)(Y.A,{className:"w-5 h-5"})})]}),(0,r.jsxs)(B.A,{anchorEl:c,open:Boolean(c),onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},PaperProps:{style:{minWidth:"120px"}},children:[(0,r.jsxs)(M.A,{disableRipple:!0,onClick:()=>{w.VC(s),p()},className:"bg-white",children:[(0,r.jsx)(Q.A,{fontSize:"small"}),a("expand")]}),(0,r.jsx)(L.i,{onDelete:()=>{w.ip(s),p()}})]})]})}const ae=(0,g.memo)((e=>{const{t:s}=(0,f.Bd)(),{thread:t,onThreadLabelClick:n}=e,l=(0,g.useCallback)((e=>{n?.(e,t.id)}),[t.id,n]);return(0,r.jsx)("div",{className:"text-center pb-4 pt-8",children:(0,r.jsxs)("span",{className:"cursor-pointer font-bold border-solid border rounded-xxl py-2 px-3 border-slate-400/25",onClick:l,children:[(0,r.jsx)("span",{className:"pr-1 opacity-60",children:"#"}),(0,r.jsx)("span",{className:"truncate inline-block align-bottom max-w-[calc(50%-4rem)] md:max-w-[calc(30%-4rem)]",children:t.name||s("New Thread")}),t.createdAtLabel&&(0,r.jsx)("span",{className:"pl-1 opacity-60 text-xs",children:t.createdAtLabel})]})})})),ce=(0,g.memo)((e=>{const{t:s}=(0,f.Bd)(),{threadMenuAnchorEl:t,threadMenuClickedTopicId:i,onThreadMenuClose:o,currentSessionId:a}=e,c=(0,m.Xr)(v.Kq),d=(0,g.useCallback)((()=>{c(i||!0),o?.()}),[i,c,o]),h=(0,g.useCallback)((()=>{i&&(n.Ay.show("thread-name-edit",{sessionId:a,threadId:i}),o?.())}),[i,a,o]),x=(0,g.useCallback)((()=>{i&&(w.pi(a,i),o?.())}),[i,a,o]),p=(0,g.useCallback)((()=>{i&&(w.bs(a,i),o?.())}),[i,a,o]),u=(0,g.useCallback)((()=>{i&&(w.x_(a,i),o?.())}),[i,a,o]);return(0,r.jsxs)(B.A,{anchorEl:t,open:Boolean(t),onClose:o,onDoubleClick:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:[(0,r.jsxs)(M.A,{disableRipple:!0,onClick:h,children:[(0,r.jsx)(l.A,{fontSize:"small"}),s("Edit Thread Name")]}),(0,r.jsxs)(M.A,{disableRipple:!0,onClick:d,children:[(0,r.jsx)(Q.A,{fontSize:"small"}),s("Show in Thread List")]}),(0,r.jsxs)(M.A,{disableRipple:!0,onClick:x,children:[(0,r.jsx)(J.A,{fontSize:"small"}),s("Continue this thread")]}),(0,r.jsxs)(M.A,{disableRipple:!0,divider:!0,onClick:p,children:[(0,r.jsx)(Z.A,{fontSize:"small"}),s("Move to Conversations")]}),(0,r.jsx)(L.i,{onDelete:u})]})}));var de=t(34862),he=t(58620),xe=t(88116),me=t(57873),pe=t(82241);function ue(){const{t:e}=(0,f.Bd)(),s=(0,m.md)(v.an),[t,n]=(0,m.fp)(v.Kq),l=(0,m.md)(v.j6),i=(0,m.md)(v.sw),o=(0,g.useMemo)((()=>Object.values(l)),[l]),a=(0,g.useRef)(null);(0,g.useEffect)((()=>{const e=setTimeout((()=>{if(a.current)if(!0===t)a.current.scrollToIndex({index:o.length-1,align:"start"});else{const e=o.findIndex((e=>e.id===t));e>=0&&a.current.scrollToIndex({index:e,align:"start"})}}),100);return()=>{clearTimeout(e)}}),[t,o]);const c=(0,g.useCallback)((e=>{const s=o.find((s=>s.id===e));s&&((0,re.Uv)(s.firstMessageId,"start"),n(!1))}),[o,n]),h=(0,g.useCallback)((e=>{w.pi(i,e),n(!1)}),[i,n]);return(0,r.jsx)(he.Ay,{anchor:"ar"===s?"left":"right",open:!!t,onClose:()=>n(!1),sx:{"& .MuiDrawer-paper":{boxSizing:"border-box",width:280,border:"none"}},..."ar"===s?{SlideProps:{direction:"right"},PaperProps:{sx:{direction:"rtl"}}}:{},children:(0,r.jsxs)(d.A,{className:"ThreadHistoryDrawer flex flex-col h-full w-full",children:[(0,r.jsx)(d.A,{sx:{padding:"1rem 0.5rem 0.2rem 0.5rem",margin:"0.1rem 0.1rem 0.1rem 0.2rem"},children:(0,r.jsx)("span",{className:"text-xs opacity-80",children:e("Thread History")})}),(0,r.jsx)(xe.A,{sx:{position:"relative",overflow:"auto","& ul":{padding:0},paddingX:"0.5rem",paddingY:"0"},className:"w-full flex-grow",component:"div",children:(0,r.jsx)(te.aY,{data:o,ref:a,increaseViewportBy:{top:500,bottom:500},itemContent:(e,s)=>(0,r.jsx)(ge,{thread:s,goto:c,showHistoryDrawer:t,switchThread:h,lastOne:e===o.length-1},e)})})]})})}function ge(e){const{t:s}=(0,f.Bd)(),{thread:t,goto:i,showHistoryDrawer:o,switchThread:a,lastOne:c}=e,d=t.id===o,p=t.name||s("New Thread"),[u,C]=g.useState(null),b=Boolean(u),k=(0,m.md)(v.sw),y=(0,A.L0)(),N=(0,g.useCallback)((()=>{n.Ay.show("thread-name-edit",{sessionId:k,threadId:t.id})}),[k,t.id]),S=(0,g.useCallback)((()=>{a(t.id)}),[a,t.id]),T=(0,g.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),C(e.currentTarget)}),[]),I=(0,g.useCallback)((()=>{C(null)}),[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(M.A,{selected:d,onClick:()=>{i(t.id)},sx:{padding:"0.1rem",margin:"0.1rem"},className:"group/thread-item",children:[(0,r.jsx)(me.A,{children:(0,r.jsx)("span",{className:"opacity-50 text-xs",children:t.messageCount})}),(0,r.jsx)(pe.A,{children:(0,r.jsxs)(x.A,{variant:"inherit",noWrap:!0,children:[p,t.createdAtLabel&&(0,r.jsx)("span",{className:"pl-1 opacity-70",children:t.createdAtLabel})]})}),(0,r.jsx)(me.A,{className:(0,j.cn)(d||u||y?"opacity-100":"opacity-0 group-hover/thread-item:opacity-100"),children:(0,r.jsx)(h.A,{onClick:T,sx:{color:"primary.main"},children:(0,r.jsx)(de.A,{fontSize:"small"})})})]},t.id),(0,r.jsxs)(B.A,{anchorEl:u,open:b,onClose:I,children:[(0,r.jsxs)(M.A,{onClick:N,disableRipple:!0,children:[(0,r.jsx)(l.A,{fontSize:"small"}),s("Edit Thread Name")]},`${t.id}-edit`),(0,r.jsxs)(M.A,{onClick:S,disableRipple:!0,divider:!0,children:[(0,r.jsx)(J.A,{fontSize:"small"}),s("Switch")]},`${t.id}-switch`),(0,r.jsx)(L.i,{onDelete:()=>{C(null),I(),c?w.ix(k):w.x_(k,t.id)}})]},`${t.id}-menu`)]})}var fe=t(71764),je=t(46497),Ce=t(833),be=t(66983);function Ae(){const e=(0,m.md)(v.wf),s=(0,m.md)(v.gx),t=(0,m.md)(v.an);return(0,r.jsx)(d.A,{className:"relative",children:(0,r.jsxs)(Ce.A,{sx:"ar"===t?{position:"absolute",left:"0.4rem",top:"-5.5rem",opacity:.6}:{position:"absolute",right:"0.4rem",top:"-5.5rem",opacity:.6},orientation:"vertical",children:[(0,r.jsx)(h.A,{onClick:()=>re.eG(),sx:{visibility:e?"hidden":"visible"},children:(0,r.jsx)(je.A,{})}),(0,r.jsx)(h.A,{onClick:()=>re.cs(),sx:{visibility:s?"hidden":"visible"},children:(0,r.jsx)(fe.A,{})})]})})}const ve=function(){const{sessionId:e}=be.q.useParams(),s=(0,m.md)(v.LM),t=(0,m.Xr)(v.f9),l=(0,m.Xr)(v.xh),i=s?.messages.length?s.messages[s.messages.length-1]:null;return(0,g.useEffect)((()=>{setTimeout((()=>{re.cs("auto")}),200)}),[]),(0,g.useEffect)((()=>{if(s){if("chat"===s.type&&s.settings){const{provider:e,modelId:r}=s.settings;t({provider:e,modelId:r})}if("picture"===s.type&&s.settings){const{provider:e,modelId:t}=s.settings;l({provider:e,modelId:t})}}}),[s?.settings,s?.type,t,l,s]),s?(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)(V,{}),(0,r.jsx)(ie,{currentSession:s},`message-list${e}`),(0,r.jsx)(Ae,{}),(0,r.jsx)($.A,{sessionId:s.id,sessionType:s.type,model:s.settings?.provider&&s.settings?.modelId?{provider:s.settings.provider,modelId:s.settings.modelId}:void 0,onStartNewThread:()=>(w.L8(),!0),onRollbackThread:()=>(w.ix(e),!0),onSelectModel:(e,t)=>{s&&(0,D.E1)({id:s.id,settings:{...s.settings||{},provider:e,modelId:t}})},onClickSessionSettings:()=>!!s&&(n.Ay.show("session-settings",{session:s}),!0),generating:i?.generating,onSubmit:async({needGenerating:s=!0,input:t="",pictureKeys:r=[],attachments:n=[],links:l=[]})=>{const i=(0,C.oH)("user",t);return r?.length&&(i.contentParts=i.contentParts??[],i.contentParts.push(...r.map((e=>({type:"image",storageKey:e}))))),w.rj({currentSessionId:e,newUserMsg:i,needGenerating:s,attachments:n,links:l}),!0},onStopGenerating:()=>!!s&&(i?.generating&&(i?.cancel?.(),w.w0(s.id,{...i,generating:!1},!0)),!0)},`input-box${s.id}`),(0,r.jsx)(ue,{})]}):null}}}]);